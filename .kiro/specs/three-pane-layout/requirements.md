# 需求文档

## 简介

本需求文档定义了 Arch-Graph BIM 图数据库智能助手的三分屏界面布局系统。该系统将实现左侧上下分屏（3D 模型 + 图谱可视化）与右侧固定对话面板的创新布局，支持动态调整、最大化/最小化，并实现三向数据联动。

## 术语表

- **系统（System）**: Arch-Graph BIM 图数据库智能助手应用程序
- **三分屏布局（Three-Pane Layout）**: 包含左上（模型）、左下（图谱）、右侧（对话）三个面板的布局
- **模型查看器（Model Viewer）**: 3D BIM 模型查看器面板，显示 Speckle 或 Three.js 渲染的建筑模型
- **图谱查看器（Graph Viewer）**: 图谱可视化面板，显示 Neo4j 图数据库的节点和关系
- **对话面板（Control Panel）**: 固定在右侧的对话控制面板，提供 LLM 交互界面
- **分屏容器（Split Pane）**: 可调整大小的分屏容器
- **最大化（Maximize）**: 使面板占据左侧全部空间的操作
- **最小化（Minimize）**: 将面板折叠为工具栏图标的操作
- **分隔条（Divider）**: 用于拖动调整上下面板高度比例的分隔条
- **同步高亮（Sync Highlight）**: 当用户在一个面板中选择元素时，其他面板同步显示相关内容

## 需求

### 需求 1

**用户故事：** 作为用户，我希望看到一个功能完整的三分屏布局界面，支持动态调整和面板状态管理，以便灵活地查看 3D 模型、图谱和对话内容

#### 验收标准

1. 当应用程序加载时，系统应显示三分屏布局，左上为模型查看器，左下为图谱查看器，右侧为固定的对话面板
2. 系统应将 70-75% 的宽度分配给左侧分屏区域，25-30% 的宽度分配给对话面板
3. 当显示左侧分屏时，系统应默认将 60% 的高度分配给模型查看器，40% 的高度分配给图谱查看器
4. 系统应在所有面板上方渲染一个横跨全宽的标题栏
5. 系统应保持响应式布局，适应不同的屏幕尺寸
6. 当用户将鼠标悬停在模型查看器和图谱查看器之间的分隔条上时，系统应显示调整大小的光标
7. 当用户拖动分隔条时，系统应实时调整模型查看器和图谱查看器之间的高度比例，并带有平滑过渡效果
8. 系统应将每个面板的最小高度限制为左侧区域高度的 20%
9. 系统应将每个面板的最大高度限制为左侧区域高度的 80%
10. 当用户双击分隔条时，系统应将高度比例重置为 60%/40%，并带有动画效果
11. 当显示模型查看器或图谱查看器时，系统应在面板标题中显示最大化和最小化按钮
12. 当用户点击任一面板的最大化按钮时，系统应将该面板扩展至占据左侧区域 100% 的高度，并将另一个面板折叠为工具栏状态
13. 当面板被最大化时，系统应将最大化按钮更改为恢复按钮
14. 当用户点击恢复按钮时，系统应将两个面板恢复到之前的高度比例，并带有动画效果
15. 当用户点击面板的最小化按钮时，系统应将该面板折叠为工具栏图标状态，仅显示基本控件
16. 系统应防止两个面板同时被最小化
17. 当面板被最小化时，系统应在折叠的工具栏中显示恢复图标按钮
18. 系统应将所有布局状态（分隔条位置、最大化/最小化状态）保存到浏览器本地存储
19. 当应用程序加载时，系统应从本地存储恢复已保存的布局配置
20. 系统应为所有布局状态变化提供平滑的 CSS 过渡效果

### 需求 2

**用户故事：** 作为用户，我希望三个面板之间能够实现完整的数据联动和同步高亮，以便在不同视图中无缝追踪和分析建筑元素及其关系

#### 验收标准

1. 当用户在模型查看器中点击元素时，系统应在图谱查看器中用明显的颜色高亮显示对应的节点
2. 当用户在模型查看器中点击元素时，系统应在对话面板中显示包含所有属性的元素属性卡片
3. 当用户在模型查看器中点击元素时，系统应将图谱查看器居中并缩放到对应的节点
4. 当用户在模型查看器中点击元素时，系统应在图谱查看器中展开并显示一度关系内的相关节点
5. 当用户在图谱查看器中点击节点时，系统应在模型查看器中用边界框高亮显示对应的元素
6. 当用户在图谱查看器中点击节点时，系统应在对话面板中显示节点属性卡片
7. 当用户在图谱查看器中点击节点时，系统应动画化模型查看器的相机，缩放并居中到对应的元素
8. 当用户在图谱查看器中点击空间节点时，系统应在模型查看器中高亮显示该空间内的所有元素
9. 当用户在图谱查看器中点击系统节点时，系统应在模型查看器中高亮显示属于该系统的所有元素
10. 当系统在对话面板中返回查询结果时，系统应在模型查看器中用颜色编码的类别高亮显示所有匹配的元素
11. 当系统在对话面板中返回查询结果时，系统应在图谱查看器中以过滤视图显示所有匹配的节点和关系
12. 当用户在对话面板中点击结果项时，系统应通过平滑动画将模型查看器和图谱查看器聚焦到该特定项
13. 当显示多个查询结果时，系统应使用调色板来区分结果类别（空间、元素、系统）
14. 系统应在对话面板中提供清除高亮按钮，以重置所有高亮并返回默认视图
15. 系统应在 500 毫秒内完成所有同步操作
16. 系统应在最大化和正常面板视图之间切换时保持高亮状态
17. 当选择多个元素时，系统应在对话面板中显示摘要卡片，显示数量和类别
18. 系统应支持键盘快捷键（Escape）来清除所有选择和高亮
19. 当在任一面板中悬停在元素上时，系统应在其他面板中显示预览高亮，而不改变选择状态
20. 系统应为所有选择变化发出自定义事件，以实现可扩展性
