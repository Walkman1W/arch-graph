# 面板最大化/最小化功能 - 可视化指南

## 状态转换图

```
┌─────────────────────────────────────────────────────────────┐
│                    面板状态转换                              │
└─────────────────────────────────────────────────────────────┘

                    ┌──────────────┐
                    │   NORMAL     │
                    │  (正常状态)   │
                    │              │
                    │  [▭] [□]     │ ← 显示最大化和最小化按钮
                    └──────┬───────┘
                           │
              ┌────────────┼────────────┐
              │                         │
         点击最大化                  点击最小化
              │                         │
              ▼                         ▼
    ┌──────────────┐            ┌──────────────┐
    │  MAXIMIZED   │            │  MINIMIZED   │
    │  (最大化)     │            │  (最小化)     │
    │              │            │              │
    │    [⇄]       │ ← 恢复按钮  │    [⇄]       │ ← 恢复按钮
    └──────┬───────┘            └──────┬───────┘
           │                           │
           └───────────┬───────────────┘
                       │
                   点击恢复
                       │
                       ▼
                 ┌──────────────┐
                 │   NORMAL     │
                 │  (恢复状态)   │
                 └──────────────┘
```

## 布局状态示例

### 1. 正常状态 (Normal)

```
┌─────────────────────────────────────┐
│ 模型查看器          [▭] [□]         │ ← 标题栏 + 按钮
├─────────────────────────────────────┤
│                                     │
│         模型内容区域                 │
│         (60% 高度)                  │
│                                     │
├═════════════════════════════════════┤ ← 可拖动分隔条
│                                     │
│         图谱内容区域                 │
│         (40% 高度)                  │
│                                     │
├─────────────────────────────────────┤
│ 图谱查看器          [▭] [□]         │ ← 标题栏 + 按钮
└─────────────────────────────────────┘
```

### 2. 模型最大化 (Model Maximized)

```
┌─────────────────────────────────────┐
│ 模型查看器             [⇄]          │ ← 恢复按钮
├─────────────────────────────────────┤
│                                     │
│                                     │
│         模型内容区域                 │
│         (100% 高度)                 │
│                                     │
│                                     │
├─────────────────────────────────────┤
│ 图谱查看器             [⇄]          │ ← 最小化工具栏
└─────────────────────────────────────┘
```

### 3. 图谱最大化 (Graph Maximized)

```
┌─────────────────────────────────────┐
│ 模型查看器             [⇄]          │ ← 最小化工具栏
├─────────────────────────────────────┤
│                                     │
│                                     │
│         图谱内容区域                 │
│         (100% 高度)                 │
│                                     │
│                                     │
├─────────────────────────────────────┤
│ 图谱查看器             [⇄]          │ ← 恢复按钮
└─────────────────────────────────────┘
```

### 4. 模型最小化 (Model Minimized)

```
┌─────────────────────────────────────┐
│ 模型查看器             [⇄]          │ ← 最小化工具栏
├─────────────────────────────────────┤
│                                     │
│                                     │
│         图谱内容区域                 │
│         (扩展高度)                   │
│                                     │
│                                     │
├─────────────────────────────────────┤
│ 图谱查看器          [▭] [□]         │ ← 正常按钮
└─────────────────────────────────────┘
```

## 按钮图标说明

| 图标 | 功能 | 显示条件 |
|------|------|----------|
| `[▭]` | 最小化 | 面板处于正常状态 |
| `[□]` | 最大化 | 面板处于正常状态 |
| `[⇄]` | 恢复 | 面板处于最大化或最小化状态 |

## 实际 SVG 图标

### 最小化图标
```svg
<svg viewBox="0 0 24 24">
  <path d="M20 12H4" />  <!-- 水平线 -->
</svg>
```

### 最大化图标
```svg
<svg viewBox="0 0 24 24">
  <path d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
  <!-- 向外扩展的箭头 -->
</svg>
```

### 恢复图标
```svg
<svg viewBox="0 0 24 24">
  <path d="M4 8h4m0 0V4m0 4L3 3m17 5h-4m0 0V4m0 4l5-5M4 16h4m0 0v4m0-4l-5 5m17-5h-4m0 0v4m0-4l5 5" />
  <!-- 向内收缩的箭头 -->
</svg>
```

## 交互流程

### 最大化流程

```
用户点击最大化按钮
    ↓
调用 maximizePane('model')
    ↓
更新状态：
  - model: 'maximized'
  - graph: 'minimized'
  - 保存 previousDividerPosition
    ↓
触发重新渲染
    ↓
应用 CSS transition (300ms)
    ↓
模型面板扩展到 100%
图谱面板折叠到 48px
    ↓
按钮更新为恢复图标
```

### 恢复流程

```
用户点击恢复按钮
    ↓
调用 restorePane('model')
    ↓
更新状态：
  - model: 'normal'
  - graph: 'normal'
  - 恢复 dividerPosition
    ↓
触发重新渲染
    ↓
应用 CSS transition (300ms)
    ↓
两个面板恢复到之前的比例
    ↓
按钮更新为最大化/最小化图标
```

### 互斥保护流程

```
用户尝试最小化第二个面板
    ↓
调用 minimizePane('graph')
    ↓
检查：paneStates.model === 'minimized'?
    ↓
是 → 阻止操作，显示警告
    ↓
否 → 执行最小化
```

## 样式类说明

### PaneHeader 样式
```css
/* 容器 */
.flex items-center justify-between px-4 py-2 bg-slate-100 border-b border-slate-200

/* 按钮 */
.p-1.5 hover:bg-slate-200 rounded transition-colors

/* 图标 */
.w-4 h-4 text-slate-600
```

### 面板容器样式
```css
/* 动画过渡 */
.transition-all duration-300 ease-in-out

/* 布局 */
.flex flex-col
```

## 高度计算公式

```typescript
// 正常状态
topHeight = dividerPosition * 100 + '%'
bottomHeight = (1 - dividerPosition) * 100 + '%'

// 最大化状态
maximizedHeight = '100%'
minimizedHeight = '48px'

// 示例：dividerPosition = 0.6
// 正常：top = 60%, bottom = 40%
// 模型最大化：top = 100%, bottom = 48px
// 图谱最大化：top = 48px, bottom = 100%
```

## 状态持久化

```typescript
// 保存到 localStorage
{
  "dividerPosition": 0.6,
  "paneStates": {
    "model": "normal",
    "graph": "normal"
  },
  "timestamp": 1234567890
}

// 键名
"arch-graph-layout-preferences"
```

## 无障碍属性

```html
<!-- 最大化按钮 -->
<button
  title="最大化"
  aria-label="最大化 模型查看器"
>
  <svg>...</svg>
</button>

<!-- 最小化按钮 -->
<button
  title="最小化"
  aria-label="最小化 模型查看器"
>
  <svg>...</svg>
</button>

<!-- 恢复按钮 -->
<button
  title="恢复"
  aria-label="恢复 模型查看器"
>
  <svg>...</svg>
</button>
```

## 性能优化

1. **useCallback**: 所有事件处理器都使用 useCallback 包装
2. **CSS Transitions**: 使用 GPU 加速的 CSS 动画
3. **条件渲染**: 最小化时不渲染内容，只渲染标题栏
4. **防抖**: 状态保存到 localStorage 时自动防抖

## 浏览器兼容性

- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+

所有现代浏览器都支持使用的 CSS 特性：
- Flexbox
- CSS Transitions
- CSS Grid (用于布局)
