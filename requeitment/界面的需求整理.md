我希望的界面布局是：

> **右侧固定对话**
> **左侧区域改为：模型（上） + 图谱（下）上下分屏**
> 两者 **都可最大化 / 最小化 / 中分**
> 同时满足：
>
> * 空间分析
> * 构件属性
> * 管线穿越
>   的数据联动

我将基于这个最新布局，帮你重新梳理成一套完整、专业、可直接进入 Figma 画原型的 **界面需求文档（最新版）**。

下面是最清晰、可直接交付 UI/前端使用的版本。

---

# 🧱 **界面结构（最新版）—— 左上下分屏 + 右侧固定对话**

## 整体布局（Top-level Layout）

```
-----------------------------------------------------------
|                     Header（全宽固定）                   |
-----------------------------------------------------------
|                |                                        |
|                |   上：3D 模型 Viewer（可最大化）        |
|   对话 Pane    |-----------------------------------------|
|   （固定右侧） |   下：图数据库 Graph（可最大化）         |
|     25~30%     |                                        |
-----------------------------------------------------------
```

* **右侧对话 Pane 固定，不参与分屏切换**
* **左侧上下两区：模型（上） + 图谱（下）可分屏**
* 每个 Pane 都有自己的 **最大化按钮**
* 最大化时占据左侧全部空间，但右侧对话仍可见
* 最小化时折叠成一个工具栏按钮（可重新打开）

---

# 🎯 **一、右侧固定对话 Pane（25–30% 宽）**

## 1.1 功能内容：

* AI 对话（LLM 聊天窗口）
* 结构化结果卡片（空间分析/属性/穿越）
* 查询历史
* 建筑语义卡片（可折叠）

## 1.2 固定行为：

* 始终可见
* 与模型和图谱保持三向联动
* 内部滚动，不影响主视图
* 有输入框 + 发送按钮

---

# 🎨 **二、左侧上半屏：模型 Viewer（可最大化）**

这是 Speckle / Three.js 区域。
参考你当前 App.tsx 中左侧的模型区域。

## 2.1 模型 Viewer 包含：

* Orbit、Pan、Zoom 工具栏（右上角）
* Section Cut（剖切）
* 高亮逻辑（空间/构件/管线）
* 点击构件 → 同步图谱 + 对话

## 2.2 行为：

* 默认占左侧 60% 高度
* 拖动分屏条可调整模型/图谱比例
* 可点击 “🔳 最大化” → 占据左侧 100%，图谱最小化
* 最小化按钮 “⬇” → 仅保留工具栏图标

---

# 🕸 **三、左侧下半屏：图数据库（Graph Pane，可最大化）**

采用 Cytoscape.js 的简约拓扑图布局。

## 3.1 图谱内容：

节点：

* Level
* Space
* Element
* System
* Pipe/Duct

关系：

* CONTAINS
* HAS_ELEMENT
* PASSES_THROUGH
* CONNECTED_TO

## 3.2 图谱模式（顶部 tabs）：

* 空间结构图
* 构件属性关系图
* 管线穿越关系图

## 3.3 行为需求：

* 默认占左侧 40% 高度
* 可拖动分屏条调节大小
* 点击最大化 → 占满左侧
* 点击最小化 → 折叠成图谱图标
* 点节点 → 同步模型聚焦 + 对话卡片

---

# 🔧 **四、左侧上下分屏的联动规则**

```
[模型 Pane] ↑↓ 分屏条 ↓↑ [图谱 Pane]
```

### 分屏条行为：

* 拖动改变上下占比（20%–80% 范围）
* 双击分屏条 → 自动恢复成 60%/40%

---

# 🎯 **五、全局 “最大化/最小化/恢复中分” 状态矩阵**

| Pane      | 最大化行为 | 最小化行为       | 中分恢复    |
| --------- | ----- | ----------- | ------- |
| 模型 Viewer | 占满左侧  | 收缩为工具栏图标    | 回到上 60% |
| 图谱 Viewer | 占满左侧  | 收缩为图谱图标     | 回到下 40% |
| 对话 Pane   | 固定，不变 | 不可最小化（保持右侧） | 固定      |

---

# 🌐 **六、针对你的三大功能需求的交互编排**

---

# **A. 空间分析（每层空间分析）**

### 用户输入：

“分析一下该建筑模型每层分别有哪些空间？”

### UI 触发：

## 模型 Pane：

* 自动高亮每层空间
* 在模型上显示空间标签

## 图谱 Pane：

* 展示 Level → Space 的树状关系图
* 自动切换到“空间结构图”模式

## 对话 Pane：

* 输出“空间分析卡片”

```
Level 1:
- Room A
- Room B
...
```

---

# **B. 构件属性查询（点击构件 / 查属性）**

### 用户：点击模型中的构件

## 模型 Pane：

* 高亮构件
* 显示小型属性卡（浮窗）

## 图谱 Pane：

* 展开构件的关系图
* Space → Element → System

## 对话 Pane：

* 输出“构件属性卡片”：

```
名称：Pipe_233  
系统：HVAC  
材质：Steel  
所属空间：Pump Room  
```

---

# **C. 管线穿越分析（穿越哪些空间）**

### 用户输入：

“这一根管穿过哪些空间？”

## 模型 Pane：

* 管线高亮（橙色）
* 动画播放穿越路径（依序闪烁空间）

## 图谱 Pane：

* 展示 Pipe → PASSES_THROUGH → Space 关系链
* 自动切换到“穿越关系图”

## 对话 Pane：

* 输出“穿越关系卡片”

```
Pipe 2331
穿越空间（顺序）：
1. L1 Corridor
2. Electrical Room
3. Pump Room
```

---

# 🧱 **七、最终 Figma 布局输入（可以直接给设计师）**

### Figma 页面包含 4 个主要 Frame：

---

## **Frame 1：Desktop 三列布局（主布局）**

```
Header (全宽)
----------------------------------------
|   上模型 Viewer     |  对话 Pane     |
|   下图谱 Viewer     |  （固定右侧）  |
----------------------------------------
```

左右分区：

* 左：可纵向上下分屏（上模型，下图谱）
* 右：固定对话 Pane

---

## **Frame 2：模型最大化模式**

左侧只显示模型，图谱折叠为图标。

---

## **Frame 3：图谱最大化模式**

左侧只显示图谱，模型折叠。

---

## **Frame 4：移动端（可选）**

* 顶部模型 Tab
* 图谱 Tab
* 对话 Tab

---