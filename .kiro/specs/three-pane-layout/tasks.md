# 实现计划

- [x] 1. 搭建核心布局基础设施和状态管理





  - 使用 React Context 创建 LayoutStateProvider 进行全局状态管理
  - 实现状态操作（setDividerPosition、maximizePane、minimizePane 等）
  - 添加本地存储持久化钩子（状态变化时保存，挂载时加载）
  - 定义 LayoutState、LayoutActions、HighlightStyle 的 TypeScript 接口
  - _需求：1.18, 1.19_

- [ ]* 1.1 编写布局状态持久化的属性测试
  - **属性 7：状态持久化往返**
  - **验证：需求 1.18, 1.19**

- [x] 2. 实现带拖动功能的 SplitPaneContainer 组件




  - 创建带有上下面板插槽的 SplitPaneContainer 组件
  - 实现带拖动处理器的分隔条（mousedown、mousemove、mouseup）
  - 添加约束强制（每个面板最小 20%，最大 80%）
  - 实现双击重置为 60%/40% 比例
  - 添加 CSS 过渡以实现平滑动画
  - 实现悬停时的调整大小光标
  - _需求：1.1, 1.3, 1.6, 1.7, 1.8, 1.9, 1.10, 1.20_

- [ ]* 2.1 编写分隔条拖动约束的属性测试
  - **属性 2：分隔条拖动约束**
  - **验证：需求 1.8, 1.9**

- [ ]* 2.2 编写双击重置的属性测试
  - **属性 3：双击重置**
  - **验证：需求 1.10**

- [x] 3. 实现面板最大化/最小化功能




  - 在面板标题中添加最大化和最小化按钮
  - 实现最大化逻辑（扩展到 100%，折叠另一个面板）
  - 实现最小化逻辑（折叠到工具栏，扩展另一个面板）
  - 添加恢复功能以返回到之前的状态
  - 实现互斥（防止两个面板同时最小化）
  - 添加按钮状态管理（根据当前状态显示最大化/恢复）
  - 存储之前的分隔条位置以进行恢复操作
  - _需求：1.11, 1.12, 1.13, 1.14, 1.15, 1.16, 1.17_

- [ ]* 3.1 编写最大化互斥性的属性测试
  - **属性 4：最大化互斥性**
  - **验证：需求 1.12**

- [ ]* 3.2 编写最大化-恢复往返的属性测试
  - **属性 5：最大化-恢复往返**
  - **验证：需求 1.14**

- [ ]* 3.3 编写最小化互斥的属性测试
  - **属性 6：最小化互斥**
  - **验证：需求 1.16**

- [ ] 4. 更新 App.tsx 以集成三分屏布局
  - 重构 App.tsx 以使用 SplitPaneContainer
  - 用 LayoutStateProvider 包装应用程序
  - 设置布局结构：标题 + （左侧分屏 + 右侧对话面板）
  - 实现响应式宽度分配（左侧 70-75%，右侧 25-30%）
  - 将面板状态属性传递给 ModelViewer 和 GraphViewer
  - _需求：1.1, 1.2, 1.4, 1.5_

- [ ]* 4.1 编写宽度分配边界的属性测试
  - **属性 1：宽度分配边界**
  - **验证：需求 1.2**

- [ ] 5. 增强 ModelViewer 组件的选择和高亮支持
  - 添加 selectedElements 和 highlightedElements 属性
  - 实现元素点击处理器，将事件传播到 LayoutStateProvider
  - 实现元素悬停处理器以进行预览高亮
  - 添加带颜色编码样式的高亮渲染逻辑
  - 为选中的元素实现相机聚焦和缩放动画
  - 为选中的元素添加边界框渲染
  - 处理面板状态变化（根据最大化/最小化状态显示/隐藏控件）
  - _需求：2.1, 2.2, 2.3, 2.4, 2.19_

- [ ]* 5.1 编写模型到图谱同步的属性测试
  - **属性 8：模型到图谱同步**
  - **验证：需求 2.1, 2.3**

- [ ] 6. 创建带 Cytoscape.js 集成的 GraphViewer 组件
  - 使用 React 包装器设置 Cytoscape.js
  - 从图数据实现节点和边的渲染
  - 添加带事件传播的节点点击处理器
  - 添加用于预览高亮的节点悬停处理器
  - 实现节点高亮样式（颜色、边框、大小）
  - 在节点选择时添加相机居中和缩放
  - 实现节点展开（显示 1 度内的相关节点）
  - 支持多种布局模式（层次、力导向、圆形）
  - 处理面板状态变化
  - _需求：2.5, 2.6, 2.7, 2.8, 2.9, 2.19_

- [ ]* 6.1 编写图谱到模型同步的属性测试
  - **属性 9：图谱到模型同步**
  - **验证：需求 2.5, 2.7**

- [ ]* 6.2 编写空间节点展开的属性测试
  - **属性 11：空间节点展开**
  - **验证：需求 2.8**

- [ ]* 6.3 编写系统节点展开的属性测试
  - **属性 12：系统节点展开**
  - **验证：需求 2.9**

- [ ] 7. 实现双向同步逻辑
  - 创建元素到节点和节点到元素映射的同步工具函数
  - 在 LayoutStateProvider 中实现带源跟踪的 selectElement 操作
  - 添加同步逻辑：当源是 'model' 时更新图谱；当源是 'graph' 时更新模型
  - 实现跨所有三个面板的高亮传播
  - 为快速选择变化添加防抖
  - 确保同步操作在 500ms 内完成（添加性能监控）
  - 为所有选择变化发出自定义事件
  - _需求：2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.15, 2.20_

- [ ]* 7.1 编写双向同步一致性的属性测试
  - **属性 10：双向同步一致性**
  - **验证：需求 2.1, 2.5**

- [ ]* 7.2 编写同步性能的属性测试
  - **属性 15：同步性能**
  - **验证：需求 2.15**

- [ ]* 7.3 编写事件发射完整性的属性测试
  - **属性 18：事件发射完整性**
  - **验证：需求 2.20**

- [ ] 8. 增强 ControlPanel 的查询结果可视化
  - 添加带分类结果的查询结果显示部分
  - 实现结果项点击处理器以触发同步
  - 为结果添加颜色编码的类别徽章（空间、元素、系统）
  - 实现清除高亮按钮
  - 添加显示数量和类别的多选摘要卡片
  - 显示选中的元素/节点属性卡片
  - 确保结果在模型和图谱查看器中触发高亮
  - _需求：2.10, 2.11, 2.12, 2.13, 2.14, 2.17_

- [ ]* 8.1 编写查询结果高亮的属性测试
  - **属性 13：查询结果高亮**
  - **验证：需求 2.10, 2.11**

- [ ]* 8.2 编写清除高亮重置的属性测试
  - **属性 14：清除高亮重置**
  - **验证：需求 2.14**

- [ ] 9. 实现悬停预览功能
  - 在 LayoutStateProvider 中添加 hoveredElement 状态
  - 在 ModelViewer 和 GraphViewer 中实现悬停处理器
  - 添加预览高亮渲染（更浅/透明样式）
  - 确保悬停不改变选择状态
  - 为悬停事件添加防抖（100ms）
  - _需求：2.19_

- [ ]* 9.1 编写悬停预览不干扰的属性测试
  - **属性 17：悬停预览不干扰**
  - **验证：需求 2.19**

- [ ] 10. 添加键盘快捷键和无障碍功能
  - 实现 Escape 键处理器以清除所有选择和高亮
  - 为面板控件添加键盘导航（Tab、Enter、Space）
  - 为所有按钮和交互元素添加 ARIA 标签
  - 实现带可见轮廓的焦点指示器
  - 为动态内容更新添加 ARIA 实时区域（选择变化、查询结果）
  - 确保所有文本的最小对比度为 4.5:1
  - 使用屏幕阅读器测试（NVDA/JAWS）
  - _需求：2.18_

- [ ]* 10.1 编写键盘快捷键功能的属性测试
  - **属性测试：Escape 键清除选择**
  - **验证：需求 2.18**

- [ ] 11. 实现视图变化时的高亮持久化
  - 更新最大化/最小化逻辑以保留高亮状态
  - 确保面板状态变化时高亮元素保持可见
  - 添加面板转换后重新应用高亮的逻辑
  - 使用各种状态变化序列测试高亮持久化
  - _需求：2.16_

- [ ]* 11.1 编写高亮持久化的属性测试
  - **属性 16：视图变化时高亮持久化**
  - **验证：需求 2.16**

- [ ] 12. 添加错误处理和降级机制
  - 在本地存储操作周围添加 try-catch，降级到默认状态
  - 实现元素未找到处理（记录警告，跳过同步）
  - 添加同步超时检测（如果 > 500ms 则取消）
  - 实现图谱布局失败降级（尝试替代布局）
  - 添加相机动画失败处理（直接跳转到位置）
  - 在 ControlPanel 中添加面向用户的错误通知
  - 将所有错误记录到控制台以便调试
  - _需求：全部（错误处理）_

- [ ] 13. 为大型数据集优化性能
  - 为 ModelViewer、GraphViewer 和 ControlPanel 实现 React.memo
  - 为计算值添加 useMemo（过滤节点、高亮样式）
  - 为所有事件处理器添加 useCallback
  - 为本地存储写入实现防抖（500ms）
  - 在 ControlPanel 中为大型结果列表添加虚拟滚动
  - 优化 Three.js 渲染（实例化、视锥剔除）
  - 优化 Cytoscape.js（节点聚类、批量更新）
  - 使用 1000+ 元素测试并测量性能
  - _需求：2.15（性能）_

- [ ] 14. 检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户。

- [ ] 15. 添加 CSS 样式和动画
  - 为布局组件创建 Tailwind CSS 类
  - 为分隔条拖动添加平滑过渡（transition-all duration-200）
  - 为最大化/最小化添加动画（缩放、不透明度）
  - 为面板标题添加按钮和图标样式
  - 为交互元素添加悬停效果
  - 为不同类别设置高亮颜色样式
  - 确保不同屏幕尺寸的响应式设计
  - 测试动画的流畅性（60 FPS 目标）
  - _需求：1.20（平滑过渡）_

- [ ] 16. 最终集成和端到端测试
  - 测试完整用户流程：加载应用 → 拖动分隔条 → 最大化面板 → 选择元素 → 验证同步
  - 测试状态持久化：调整布局 → 重新加载 → 验证恢复
  - 测试所有键盘快捷键
  - 测试错误场景（损坏的存储、缺失的元素）
  - 验证性能目标（< 500ms 同步，60 FPS 动画）
  - 在多个浏览器上测试（Chrome、Firefox、Safari、Edge）
  - 在不同屏幕尺寸上测试（1920x1080、1366x768、2560x1440）
  - _需求：全部_

- [ ] 17. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户。
